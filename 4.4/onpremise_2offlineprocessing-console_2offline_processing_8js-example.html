<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Device Detection Node.js: onpremise/offlineprocessing-console/offlineProcessing.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="../../documentation/4.4/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees Device Detection Node.js
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">51Degrees Device Detection for Node.js</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('onpremise_2offlineprocessing-console_2offline_processing_8js-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">onpremise/offlineprocessing-console/offlineProcessing.js</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>Provides an example of processing a YAML file containing evidence for device detection.There are 20,000 examples in the supplied file of evidence representing HTTP Headers. For example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">header.user - agent: <span class="c-code__stringliteral">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36&#39;</span></div><div class="c-code__line">header.sec - ch - ua: <span class="c-code__stringliteral">&#39;&quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;98&quot;, &quot;Google Chrome&quot;;v=&quot;98&quot;&#39;</span></div><div class="c-code__line">header.sec - ch - ua - full - version: <span class="c-code__stringliteral">&#39;&quot;98.0.4758.87&quot;&#39;</span></div><div class="c-code__line">header.sec - ch - ua - mobile: <span class="c-code__stringliteral">&#39;?0&#39;</span></div><div class="c-code__line">header.sec - ch - ua - platform: <span class="c-code__stringliteral">&#39;&quot;Android&quot;&#39;</span></div></div><p>We create a device detection pipeline to read the data and find out about the associated device, we write this data to a YAML formatted output stream.</p>
<p>As well as explaining the basic operation of off line processing using the defaults, for advanced operation this example can be used to experiment with tuning device detection for performance and predictive power using Performance <a class="el" href="class_profile.html">Profile</a>, Graph and Difference and Drift settings.</p>
<p>This example is available in full on <a href="https://github.com/51Degrees/device-detection-node/blob/master/fiftyone.devicedetection.onpremise/examples/onpremise/offlineprocessing-console/offlineProcessing.js">GitHub</a>.</p>
<p>Required npm Dependencies:</p><ul>
<li>fiftyone.pipeline.core</li>
<li>fiftyone.pipeline.engines</li>
<li>fiftyone.pipeline.engines.fiftyone</li>
<li>fiftyone.devicedetection.onpremise</li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">const</span> LineReader = require(<span class="c-code__stringliteral">&#39;n-readlines&#39;</span>);</div><div class="c-code__line"><span class="c-code__keyword">const</span> path = require(<span class="c-code__stringliteral">&#39;path&#39;</span>);</div><div class="c-code__line"><span class="c-code__keyword">const</span> require51 = (requestedPackage) =&gt; {</div><div class="c-code__line">  <span class="c-code__keywordflow">try</span> {</div><div class="c-code__line">    <span class="c-code__keywordflow">return</span> require(path.join(__dirname, <span class="c-code__stringliteral">&#39;/../../../node_modules/&#39;</span>, requestedPackage));</div><div class="c-code__line">  } <span class="c-code__keywordflow">catch</span> (e) {</div><div class="c-code__line">    <span class="c-code__keywordflow">return</span> require(path.join(__dirname, <span class="c-code__stringliteral">&#39;/../../../../&#39;</span>, requestedPackage));</div><div class="c-code__line">  }</div><div class="c-code__line">};</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">const</span> <a name="_a0"></a><a class="code" href="class_device_detection_on_premise_pipeline_builder.html">DeviceDetectionOnPremisePipelineBuilder</a> =</div><div class="c-code__line">  require51(<span class="c-code__stringliteral">&#39;fiftyone.devicedetection.onpremise&#39;</span>).DeviceDetectionOnPremisePipelineBuilder;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">const</span> <a name="_a1"></a><a class="code" href="class_example_utils.html">ExampleUtils</a> = require(path.join(__dirname, <span class="c-code__stringliteral">&#39;/../exampleUtils&#39;</span>)).<a class="code" href="class_example_utils.html">ExampleUtils</a>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">const</span> <a name="_a2"></a><a class="code" href="class_data_extension.html">DataExtension</a> = require51(<span class="c-code__stringliteral">&#39;fiftyone.devicedetection.shared&#39;</span>).dataExtension;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// In this example, by default, the 51degrees &quot;Lite&quot; file needs to be somewhere in the</span></div><div class="c-code__line"><span class="c-code__comment">// project space, or you may specify another file as a command line parameter.</span></div><div class="c-code__line"><span class="c-code__comment">//</span></div><div class="c-code__line"><span class="c-code__comment">// Note that the Lite data file is only used for illustration, and has limited accuracy</span></div><div class="c-code__line"><span class="c-code__comment">// and capabilities. Find out about the Enterprise data file on our pricing page:</span></div><div class="c-code__line"><span class="c-code__comment">// https://51degrees.com/pricing</span></div><div class="c-code__line"><span class="c-code__keyword">const</span> LITE_V_4_1_HASH = <span class="c-code__stringliteral">&#39;51Degrees-LiteV4.1.hash&#39;</span>;</div><div class="c-code__line"><span class="c-code__comment">// This file contains the 20,000 most commonly seen combinations of header values</span></div><div class="c-code__line"><span class="c-code__comment">// that are relevant to device detection. For example, User-Agent and UA-CH headers.</span></div><div class="c-code__line"><span class="c-code__keyword">const</span> EVIDENCE = <span class="c-code__stringliteral">&#39;20000 Evidence Records.yml&#39;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Check if files exists</span></div><div class="c-code__line"><span class="c-code__keyword">const</span> fs = require(<span class="c-code__stringliteral">&#39;fs&#39;</span>);</div><div class="c-code__line"><span class="c-code__keyword">const</span> yaml = require(<span class="c-code__stringliteral">&#39;js-yaml&#39;</span>);</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">const</span> analyzeEvidence = async <span class="c-code__keyword">function</span> (evidence, pipeline, outputFile, outputFunc) {</div><div class="c-code__line">  <span class="c-code__comment">// FlowData is a data structure that is used to convey</span></div><div class="c-code__line">  <span class="c-code__comment">// information required for detection and the results of the</span></div><div class="c-code__line">  <span class="c-code__comment">// detection through the pipeline.</span></div><div class="c-code__line">  <span class="c-code__comment">// Information required for detection is called &quot;evidence&quot;</span></div><div class="c-code__line">  <span class="c-code__comment">// and usually consists of a number of HTTP Header field</span></div><div class="c-code__line">  <span class="c-code__comment">// values, in this case represented by a</span></div><div class="c-code__line">  <span class="c-code__comment">// Object of header name/value entries.</span></div><div class="c-code__line">  <span class="c-code__keyword">const</span> data = pipeline.createFlowData();</div><div class="c-code__line">  <span class="c-code__keyword">const</span> document = {};</div><div class="c-code__line"></div><div class="c-code__line">  <span class="c-code__comment">// Add the evidence values to the output and add it to output object</span></div><div class="c-code__line">  <span class="c-code__comment">// at the same time</span></div><div class="c-code__line">  <span class="c-code__keywordflow">for</span> (<span class="c-code__keyword">const</span> [key, value] of Object.entries(evidence)) {</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (value === <span class="c-code__keyword">null</span>) {</div><div class="c-code__line">      data.evidence.add(key, <span class="c-code__stringliteral">&#39;&#39;</span>);</div><div class="c-code__line">    } <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">      data.evidence.add(key, value.toString());</div><div class="c-code__line">    }</div><div class="c-code__line">    document[key] = value;</div><div class="c-code__line">  }</div><div class="c-code__line"></div><div class="c-code__line">  await data.process();</div><div class="c-code__line"></div><div class="c-code__line">  <span class="c-code__comment">// Now add the values that we want to store against the record.</span></div><div class="c-code__line">  <span class="c-code__keyword">const</span> device = data.device;</div><div class="c-code__line">  document[<span class="c-code__stringliteral">&#39;device.ismobile&#39;</span>] = <a class="code" href="class_data_extension.html">DataExtension</a>.<a name="a3"></a><a class="code" href="class_data_extension.html#a208dbc998aec51823620213f54daf71b">getValueHelper</a>(device, <span class="c-code__stringliteral">&#39;ismobile&#39;</span>);</div><div class="c-code__line">  document[<span class="c-code__stringliteral">&#39;device.platformname&#39;</span>] = <a class="code" href="class_data_extension.html">DataExtension</a>.<a class="code" href="class_data_extension.html#a208dbc998aec51823620213f54daf71b">getValueHelper</a>(device, <span class="c-code__stringliteral">&#39;platformname&#39;</span>);</div><div class="c-code__line">  document[<span class="c-code__stringliteral">&#39;device.platformversion&#39;</span>] = <a class="code" href="class_data_extension.html">DataExtension</a>.<a class="code" href="class_data_extension.html#a208dbc998aec51823620213f54daf71b">getValueHelper</a>(device, <span class="c-code__stringliteral">&#39;platformversion&#39;</span>);</div><div class="c-code__line">  document[<span class="c-code__stringliteral">&#39;device.browsername&#39;</span>] = <a class="code" href="class_data_extension.html">DataExtension</a>.<a class="code" href="class_data_extension.html#a208dbc998aec51823620213f54daf71b">getValueHelper</a>(device, <span class="c-code__stringliteral">&#39;browsername&#39;</span>);</div><div class="c-code__line">  document[<span class="c-code__stringliteral">&#39;device.browserversion&#39;</span>] = <a class="code" href="class_data_extension.html">DataExtension</a>.<a class="code" href="class_data_extension.html#a208dbc998aec51823620213f54daf71b">getValueHelper</a>(device, <span class="c-code__stringliteral">&#39;browserversion&#39;</span>);</div><div class="c-code__line">  <span class="c-code__comment">// DeviceId is a unique identifier for the combination of hardware, operating</span></div><div class="c-code__line">  <span class="c-code__comment">// system, browser and crawler that has been detected.</span></div><div class="c-code__line">  <span class="c-code__comment">// Our device detection solution uses machine learning to find the optimal</span></div><div class="c-code__line">  <span class="c-code__comment">// way to identify devices based on the real-world evidence values that we</span></div><div class="c-code__line">  <span class="c-code__comment">// observe each day.</span></div><div class="c-code__line">  <span class="c-code__comment">// As this changes over time, the result of detection can potentially change</span></div><div class="c-code__line">  <span class="c-code__comment">// as well. By storing the device id, we can use this as a lookup in future</span></div><div class="c-code__line">  <span class="c-code__comment">// rather than performing detection with the original evidence again.</span></div><div class="c-code__line">  <span class="c-code__comment">// Do this by passing an evidence entry with:</span></div><div class="c-code__line">  <span class="c-code__comment">// key = query.51D_ProfileIds</span></div><div class="c-code__line">  <span class="c-code__comment">// value = [the device id]</span></div><div class="c-code__line">  <span class="c-code__comment">// This is much faster and avoids the potential for getting a different</span></div><div class="c-code__line">  <span class="c-code__comment">// result.</span></div><div class="c-code__line">  document[<span class="c-code__stringliteral">&#39;device.deviceID&#39;</span>] = <a class="code" href="class_data_extension.html">DataExtension</a>.<a class="code" href="class_data_extension.html#a208dbc998aec51823620213f54daf71b">getValueHelper</a>(device, <span class="c-code__stringliteral">&#39;deviceID&#39;</span>);</div><div class="c-code__line">  outputFunc(outputFile, yaml.dump(document));</div><div class="c-code__line">};</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">const</span> run = async <span class="c-code__keyword">function</span> (dataFile, evidenceFile, outputFile, outputFunc) {</div><div class="c-code__line">  <span class="c-code__comment">// In this example, we use the DeviceDetectionOnPremisePipelineBuilder</span></div><div class="c-code__line">  <span class="c-code__comment">// and configure it in code. For more information about</span></div><div class="c-code__line">  <span class="c-code__comment">// pipelines in general see the documentation at</span></div><div class="c-code__line">  <span class="c-code__comment">// https://51degrees.com/documentation/_concepts__configuration__builders__index.html</span></div><div class="c-code__line">  <span class="c-code__keyword">const</span> pipeline = <span class="c-code__keyword">new</span> <a class="code" href="class_device_detection_on_premise_pipeline_builder.html">DeviceDetectionOnPremisePipelineBuilder</a>({</div><div class="c-code__line">    dataFile,</div><div class="c-code__line">    <span class="c-code__comment">// We use the low memory profile as its performance is</span></div><div class="c-code__line">    <span class="c-code__comment">// sufficient for this example. See the documentation for</span></div><div class="c-code__line">    <span class="c-code__comment">// more detail on this and other configuration options:</span></div><div class="c-code__line">    <span class="c-code__comment">// https://51degrees.com/documentation/_device_detection__features__performance_options.html</span></div><div class="c-code__line">    <span class="c-code__comment">// https://51degrees.com/documentation/_features__automatic_datafile_updates.html</span></div><div class="c-code__line">    <span class="c-code__comment">// https://51degrees.com/documentation/_features__usage_sharing.html</span></div><div class="c-code__line">    performanceProfile: <span class="c-code__stringliteral">&#39;LowMemory&#39;</span>,</div><div class="c-code__line">    <span class="c-code__comment">//  Inhibit sharing usage for this example.</span></div><div class="c-code__line">    <span class="c-code__comment">// In general, off line processing usage should NOT be shared back to 51Degrees.</span></div><div class="c-code__line">    <span class="c-code__comment">// This is because it will not contain the full set of information that is</span></div><div class="c-code__line">    <span class="c-code__comment">// required by our data processing back-end and will be discarded.</span></div><div class="c-code__line">    <span class="c-code__comment">// If you specifically want to share data that is being processed off line</span></div><div class="c-code__line">    <span class="c-code__comment">// in order to help us improve detection of new devices/browsers/etc, then</span></div><div class="c-code__line">    <span class="c-code__comment">// this additional data will need to be collected and included as evidence</span></div><div class="c-code__line">    <span class="c-code__comment">// to the Pipeline. See</span></div><div class="c-code__line">    <span class="c-code__comment">// https://51degrees.com/documentation/_features__usage_sharing.html#Low_Level_Usage_Sharing</span></div><div class="c-code__line">    <span class="c-code__comment">// for more details on this.</span></div><div class="c-code__line">    shareUsage: <span class="c-code__keyword">false</span>,</div><div class="c-code__line">    <span class="c-code__comment">// inhibit auto-update of the data file for this test</span></div><div class="c-code__line">    autoUpdate: <span class="c-code__keyword">false</span>,</div><div class="c-code__line">    updateOnStart: <span class="c-code__keyword">false</span>,</div><div class="c-code__line">    fileSystemWatcher: <span class="c-code__keyword">false</span></div><div class="c-code__line">  }).build();</div><div class="c-code__line"></div><div class="c-code__line">  <span class="c-code__comment">// Create lines reader for the evidence file</span></div><div class="c-code__line">  <span class="c-code__keyword">const</span> liner = <span class="c-code__keyword">new</span> LineReader(evidenceFile);</div><div class="c-code__line">  let buffer, utf8Line, evidence;</div><div class="c-code__line">  let records = 0;</div><div class="c-code__line"></div><div class="c-code__line">  <span class="c-code__comment">// Start reading evidence from file</span></div><div class="c-code__line">  let document = <span class="c-code__stringliteral">&#39;&#39;</span>;</div><div class="c-code__line">  <span class="c-code__keywordflow">while</span> ((buffer = liner.next())) {</div><div class="c-code__line">    utf8Line = buffer.toString(<span class="c-code__stringliteral">&#39;utf8&#39;</span>).trim();</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> ((utf8Line.match(/^---/) || utf8Line.match(/^\.\.\./)) &amp;&amp; document) {</div><div class="c-code__line">      <span class="c-code__comment">// Output progress</span></div><div class="c-code__line">      records++;</div><div class="c-code__line">      <span class="c-code__keywordflow">if</span> (records % 1000 === 0) {</div><div class="c-code__line">        console.log(`Processed ${records} records`);</div><div class="c-code__line">      }</div><div class="c-code__line"></div><div class="c-code__line">      <span class="c-code__comment">// Write the yaml document separator</span></div><div class="c-code__line">      outputFunc(outputFile, <span class="c-code__stringliteral">&#39;---\n&#39;</span>);</div><div class="c-code__line"></div><div class="c-code__line">      <span class="c-code__comment">// Load a yaml document</span></div><div class="c-code__line">      evidence = yaml.load(document);</div><div class="c-code__line">      await analyzeEvidence(evidence, pipeline, outputFile, outputFunc);</div><div class="c-code__line"></div><div class="c-code__line">      <span class="c-code__comment">// Stop processing if reach end of file</span></div><div class="c-code__line">      <span class="c-code__keywordflow">if</span> (utf8Line.match(/^\.\.\./)) {</div><div class="c-code__line">        <span class="c-code__keywordflow">break</span>;</div><div class="c-code__line">      }</div><div class="c-code__line"></div><div class="c-code__line">      <span class="c-code__comment">// Move the document separator to the string buffer</span></div><div class="c-code__line">      document = `${utf8Line}\n`;</div><div class="c-code__line">    } <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">      document += `${utf8Line}\n`;</div><div class="c-code__line">    }</div><div class="c-code__line">  }</div><div class="c-code__line">  <span class="c-code__comment">// Write the yaml document end marker</span></div><div class="c-code__line">  outputFunc(outputFile, <span class="c-code__stringliteral">&#39;...\n&#39;</span>);</div><div class="c-code__line"></div><div class="c-code__line">  <a class="code" href="class_example_utils.html">ExampleUtils</a>.<a name="a4"></a>checkDataFile(pipeline, dataFile);</div><div class="c-code__line"></div><div class="c-code__line">  console.log(`Processing complete. See results in: <span class="c-code__stringliteral">&#39;${outputFile}&#39;</span>`);</div><div class="c-code__line">};</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Don&#39;t run the server if under TEST</span></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> (process.env.JEST_WORKER_ID === undefined) {</div><div class="c-code__line">  <span class="c-code__keyword">const</span> args = process.argv.slice(2);</div><div class="c-code__line">  <span class="c-code__comment">// Use the supplied path for the data file or find the lite</span></div><div class="c-code__line">  <span class="c-code__comment">// file that is included in the repository.</span></div><div class="c-code__line">  <span class="c-code__keyword">const</span> dataFile = args.length &gt; 0 ? args[0] : <a class="code" href="class_example_utils.html">ExampleUtils</a>.<a name="a5"></a>findFile(LITE_V_4_1_HASH);</div><div class="c-code__line">  <span class="c-code__comment">// Do the same for the yaml evidence file</span></div><div class="c-code__line">  <span class="c-code__keyword">const</span> evidenceFile = args.length &gt; 1 ? args[1] : <a class="code" href="class_example_utils.html">ExampleUtils</a>.findFile(EVIDENCE);</div><div class="c-code__line">  <span class="c-code__comment">// Finally, get the location for the output file. Use the same location as the</span></div><div class="c-code__line">  <span class="c-code__comment">// evidence if a path is not supplied on the command line.</span></div><div class="c-code__line">  <span class="c-code__keyword">const</span> outputFile = args.length &gt; 2</div><div class="c-code__line">    ? args[2]</div><div class="c-code__line">    : path.join(path.dirname(path.resolve(evidenceFile)), <span class="c-code__stringliteral">&#39;offline-processing-output.yml&#39;</span>);</div><div class="c-code__line"></div><div class="c-code__line">  <span class="c-code__keywordflow">if</span> (dataFile !== undefined) {</div><div class="c-code__line">    <span class="c-code__comment">// Create output file or overwrite the existing one</span></div><div class="c-code__line">    fs.writeFileSync(outputFile, <span class="c-code__stringliteral">&#39;&#39;</span>);</div><div class="c-code__line">    run(</div><div class="c-code__line">      dataFile,</div><div class="c-code__line">      evidenceFile,</div><div class="c-code__line">      outputFile,</div><div class="c-code__line">      (output, content) =&gt; { fs.appendFileSync(output, content); });</div><div class="c-code__line">  } <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    console.error(<span class="c-code__stringliteral">&#39;Failed to find a device detection &#39;</span> +</div><div class="c-code__line">      <span class="c-code__stringliteral">&#39;data file. Make sure the device-detection-data &#39;</span> +</div><div class="c-code__line">      <span class="c-code__stringliteral">&#39;submodule has been updated by running &#39;</span> +</div><div class="c-code__line">      <span class="c-code__stringliteral">&#39;`git submodule update --recursive`.&#39;</span>);</div><div class="c-code__line">  }</div><div class="c-code__line">};</div><div class="c-code__line"></div><div class="c-code__line">module.exports = {</div><div class="c-code__line">  run</div><div class="c-code__line">};</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
